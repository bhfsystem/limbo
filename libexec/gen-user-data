#!/usr/bin/env bash

function main {
  local shome="${_limbo_home:-"$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"}"
  source "$shome/script/profile"

  echo '#cloud-config'
  jq -n \
    --arg ssh_key "$(cat "${CACHE_DIR}/.ssh/ssh-vagrant.pub")" \
    --arg sudo "ALL=(ALL) NOPASSWD: ALL" '{
			users: [ {name: "ubuntu", "ssh-authorized-keys": [ $ssh_key ], sudo: $sudo } ]
    }' | python3.5 -c 'import json; import yaml; import sys; print(yaml.dump(json.load(sys.stdin)))'
}

main "$@"
