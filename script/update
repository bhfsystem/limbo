#!/usr/bin/env bash

function bootstrap {
  local shome="${_limbo_home:-"$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"}"
  source "$shome/script/profile"

  mkdir -p "${BASEBOX_CACHE}/tmp"

  if "$shome/script/stale"; then
    "$shome/script/bootstrap"
  fi

  cat "$shome/etc/squid.conf.template" | envsubst '${BASEBOX_CACHE}' > "$shome/etc/squid.conf"
  mkdir -p "${BASEBOX_CACHE}/cache/squid"
  squid -f "$shome/etc/squid.conf" -zN
  block compile service

  make
}

bootstrap

