#!/usr/bin/env bash

function main {
  local net_bridge="$1"; shift

  sudo aptitude update
  sudo aptitude install -y bridge-utils

  if ifconfig br0 2>/dev/null; then
    return 0
  fi

  sudo brctl addbr br0
  sudo ip addr add "${net_bridge}/24" dev br0
  sudo ip link set dev br0 up
  sudo ip addr show br0

  if lvs system/docker-data; then
    if ! lvs system/docker-data | awk 'NR == 2 { print $3 }' | grep ^t; then
      sudo lvremove -f system/docker-data || true
      sudo lvcreate -T -L 20G --poolmetadatasize 4G system/docker-data
    fi
  fi

	sudo lvs
  lsblk
}

main "$@"
